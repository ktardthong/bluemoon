<md-content>
  <div ui-view="header"></div>

  <section class="gray-background margin-top">

    <div layout="row" class="container animated slideInUp">

      <md-sidenav
        flex-auto
        layout="column"
        class="md-sidenav-left gray-background md-padding"
        md-component-id="left"
        md-is-locked-open="$mdMedia('gt-sm')">

        <md-content class="md-padding md-whiteframe-1dp">
          Login
        </md-content>

        <md-content class="md-whiteframe-1dp">
          <md-list>
            <md-subheader class="md-no-sticky">
              <i class="ion-arrow-graph-up-right"></i>
              Trending
            </md-subheader>
            <md-list-item class="md-3-line" ng-repeat="item in todos">
              <img ng-src="{{item.face}}?{{$index}}" class="md-avatar" alt="{{item.who}}" />
              <div class="md-list-item-text" layout="column">
                <h3>{{ item.who }}</h3>
                <h4>{{ item.what }}</h4>
                <p>{{ item.notes }}</p>
              </div>
            </md-list-item>
          </md-list>
        </md-content>

        <md-content class="md-whiteframe-1dp">
          <md-list>
            <md-subheader class="md-no-sticky">Trending</md-subheader>
            <md-list-item class="md-3-line" ng-repeat="item in todos">
              <img ng-src="{{item.face}}?{{$index}}" class="md-avatar" alt="{{item.who}}" />
              <div class="md-list-item-text" layout="column">
                <h3>{{ item.who }}</h3>
                <h4>{{ item.what }}</h4>
                <p>{{ item.notes }}</p>
              </div>
            </md-list-item>
          </md-list>
        </md-content>

      </md-sidenav>


      <div flex-auto class="md-padding">

        <!-- Creation form -->
        <div ng-controller="TopicCtrl as topicCtrl">

          <md-content ng-if="topicCtrl.auth.ref.getAuth().uid" class="md-padding md-whiteframe-1dp">

            <form ng-submit="topicCtrl.createTopic(cateCtrl.cateName.$id,topic.isDraft)"
                  ng-init="topic.isDraft = 0">
              <md-list>
                <md-list-item>
                  <img ng-src="{{topicCtrl.profile.photo}}"
                       class="img-circle" width="36px">

                  <md-button ng-show="showFormInputBtn"
                             ng-init="showFormInputBtn = true"
                             ng-click="formInput = true;
                                       showFormInputBtn = false">What's on your mind?</md-button>

                  <div class="md-list-item-text"
                       layout="column"
                       ng-show="formInput"
                       ng-init="formInput = false">


                    <!-- Types of topic-->
                    <md-input-container class="md-block" flex-gt-sm>
                      <label>Create</label>
                      <md-select ng-model="topicCtrl.type">
                        <md-option value="question"><i class="ion-help"></i> Question</md-option>
                        <md-option value="topic"><i class="ion-chatbubble-working"></i> New topic </md-option>
                      </md-select>
                    </md-input-container>


                    <!-- Topics -->
                    <md-input-container flex="" ng-keyup="topicCtrl.checkSlug();topicCtrl.body.show = true">
                      <label>Topic</label>
                      <input ng-model="topicCtrl.newTopic.topic" autocomplete="off">
                    </md-input-container>

                    <!-- Languages -->
                    <md-input-container style="margin-right: 10px;">
                      <label>Languages</label>
                      <md-select ng-model="topicCtrl.newTopic.lang">
                        <md-option ng-repeat="lang in topicCtrl.languages"
                                   value="{{lang.$id}}">
                          {{lang.translated_name}}
                        </md-option>
                      </md-select>
                    </md-input-container>


                    <!-- Check slug -->
                    <div ng-if="topicCtrl.slugReturn != null">
                      <p class="md-title">Topic already exist</p>
                      <!-- if the topic's slug exist list them here -->
                      <div ng-repeat="data in topicCtrl.slugReturn">
                        {{data}}
                      </div>
                    </div>


                    <div ng-init="topicCtrl.body.show = false" ng-show="topicCtrl.body.show">

                      <!-- Body -->
                      <md-input-container class="md-block">
                        <label>Your story</label>
                        <textarea ng-model="topicCtrl.newTopic.body" columns="1" rows="5"></textarea>
                      </md-input-container>

                      <!-- Tags -->
                      <!--<input ng-model="topicCtrl.newTopic.tags">-->
                      <tags-input ng-model="tags"></tags-input>

                      <p ng-if="locationDetail.details.place_id">location</p>
                    </div>


              <!-- Optional -->
              <div layout="row" ng-init="topicCtrl.body.show = false" ng-show="topicCtrl.body.show">

                <div flow-init
                     flow-name="uploader.flow"
                     flow-files-added="topicCtrl.uploadFile($files)">
                  <md-button aria-label="Photo" class="md-primary md-fab md-mini ion-camera" flow-btn type="file"></md-button>
                  <div ng-repeat="image in uploader.flow.files track by $index">
                    <img class="preview" flow-img="image"/><br>
                  </div>
                </div>

                <!-- Location input -->
                <md-button aria-label="Location" class="md-primary md-fab md-mini ion-location" ng-click="locationInput=true"></md-button>
                  <md-input-container ng-show="locationInput" ng-init="locationInput=false">
                    <input aria-label="Location Query"
                           ng-autocomplete type="text"
                           ng-model = "topicCtrl.newTopic.location.query"
                           details  = "topicCtrl.newTopic.location.details"
                           options  = "topicCtrl.newTopic.location.options">
                  </md-input-container>


                <!-- URL input -->
                <md-button aria-label="Link" class="md-primary md-fab md-mini ion-link" ng-click="urlInput=true"></md-button>
                  <md-input-container ng-show="urlInput" ng-init="urlInput=false">
                    <input aria-label="URL" ng-model="topicCtrl.newTopic.url">
                  </md-input-container>


                <!-- Save as draft -->
                <md-button ng-if="topicCtrl.newTopic.topic.length > 0"
                           class="md-primary" type="submit"
                           aria-label="Save as Draft"
                           ng-click="topic.isDraft=1">Save as draft</md-button>
              </div>

              <md-card-actions layout="row" layout-align="end center">
                <md-button class="md-primary md-raised" type="submit">submit</md-button>
              </md-card-actions>
                  </div>
                </md-list-item>
              </md-list>
            </form>

          </md-content>
        </div>

        <!-- Topic Category -->
        <p class="text-center md-headline md-padding">
          {{cateCtrl.cateName.name}}
        </p>

        <!-- List topics here-->
        <topic-list topics="cateCtrl.cateTopics"></topic-list>
      </div>
    </div>

  </section>

</md-content>
