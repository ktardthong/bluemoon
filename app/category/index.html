<md-content>
  <div ui-view="header"></div>

  <section class="gray-background">

    <div layout="column" class="inner-container container margin-top">

      <!-- Creation form -->
      <div ng-controller="TopicCtrl as topicCtrl">
        <md-content ng-if="topicCtrl.auth.ref.getAuth().uid" class="md-padding md-whiteframe-1dp">
          <form ng-submit="topicCtrl.createTopic(cateCtrl.cateName.$id)">
            <md-list>
              <md-list-item class="md-3-line">
                <img src="https://lh3.googleusercontent.com/-ONIXPD1ozmQ/AAAAAAAAAAI/AAAAAAAAD8Q/HB38gqJDdyU/s36-p-k-rw-no/photo.jpg"
                     class="img-circle">
                <div class="md-list-item-text" layout="column">

                  <!-- Topics -->
                  <md-input-container ng-click="topicCtrl.body.show = true" flex="">
                    <label>Topic</label>
                    <input ng-model="topicCtrl.newTopic.topic">
                  </md-input-container>

                  <div ng-init="topicCtrl.body.show = false" ng-show="topicCtrl.body.show">

                    <!-- Body -->
                    <md-input-container class="md-block">
                      <label>Your story</label>
                      <textarea ng-model="topicCtrl.newTopic.body" columns="1" rows="5"></textarea>
                    </md-input-container>

                    <!-- Tags -->
                    <md-input-container ng-click="topicCtrl.body.show = true" flex="">
                      <label>#tags</label>
                      <input ng-model="topicCtrl.newTopic.tags">
                    </md-input-container>

                  </div>
                </div>
              </md-list-item>
            </md-list>

            <!-- Optional -->
            <div layout="row">
              <div flow-init ng-init="topicCtrl.body.show = false" ng-show="topicCtrl.body.show"
                   flow-name="uploader.flow"
                   flow-files-added="topicCtrl.uploadFile($files)">
                <md-button class="md-primary md-fab md-mini ion-camera" flow-btn type="file"></md-button>
                <md-button class="md-primary md-fab md-mini ion-location"></md-button>
                <md-button class="md-primary md-fab md-mini ion-link"></md-button>
                <div ng-repeat="image in uploader.flow.files track by $index">
                  <img class="preview" flow-img="image"/><br>
                </div>
              </div>

              <md-button ng-if="topicCtrl.newTopic.topic.length > 0" class="md-primary" type="submit">Save as draft</md-button>
            </div>

            <md-card-actions layout="row" layout-align="end center" ng-init="topicCtrl.body.show = false" ng-show="topicCtrl.body.show">
              <md-button class="md-primary md-raised" type="submit">submit</md-button>
            </md-card-actions>
          </form>
        </md-content>
      </div>


      <p class="text-center md-title">
        {{cateCtrl.cateName.name}}
      </p>

      <!-- List topics here-->
      <div ng-repeat="(topicKey, topic) in cateCtrl.cateTopics | orderObjectBy:'created':true">
        <md-card class="md-whiteframe-2dp">
          <md-card-title>
            <md-card-title-text>
              <small>
                <i class="ion-ios-clock-outline"></i>
                <span am-time-ago="topic.created"></span>
              </small>
              <span class="md-title text-center">
                <a ui-sref="topic({Slug: topic.slug, Key: topicKey })">{{topic.topic}}</a>
              </span>
            </md-card-title-text>
          </md-card-title>

          <md-card-content>
            <p>
              {{topic.body}}
            </p>
          </md-card-content>

          <div ng-if="topic.photos" ng-repeat="photo in topic.photos">
            <img ng-src="{{photo}}" class="md-card-image" alt="Washed Out">
          </div>


          <md-card-actions layout="row" layout-align="start center">
            <md-card-icon-actions>
              <md-button class="md-primary ion-chevron-up"  aria-label="Upvote"> Upvote</md-button>
              <md-button class="ion-chevron-down"           aria-label="Downvote"> Downvote</md-button>
              <md-button class="ion-chatbubble-working"     aria-label="Comments"> Comments 2 </md-button>
              <md-button class="ion-share"     aria-label="Share"> Share </md-button>
            </md-card-icon-actions>
          </md-card-actions>

        </md-card>
      </div>
    </div>
  </section>

</md-content>
